<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>KarmYog - Service Provider Dashboard</title>
    <script src="https://code.jquery.com/jquery-3.7.1.min.js"
    integrity="sha256-/JqT3SQfawRcv/BIHPThkBvs0OEvtFFmqPF/lYI/Cxo=" crossorigin="anonymous"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <style>
      body {
        font-family: 'Inter', sans-serif;
        background-color: #f8fafc;
        color: #334155;
      }

      .stats-card {
        background: white;
        border-radius: 12px;
        border: none;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        overflow: hidden;
      }

      .stats-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      }

      .action-card {
        background: white;
        border-radius: 12px;
        border: none;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        transition: all 0.3s ease;
        height: 100%;
      }

      .action-card:hover {
        transform: translateY(-2px);
        box-shadow: 0 4px 12px rgba(0,0,0,0.15);
      }

      .gradient-bg {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .stat-icon {
        width: 60px;
        height: 60px;
        border-radius: 12px;
        display: flex;
        align-items: center;
        justify-content: center;
        font-size: 24px;
        color: white;
      }

      .navbar {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      }

      .page-header {
        background: white;
        border-radius: 12px;
        box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        margin-bottom: 2rem;
        padding: 2rem;
      }

      .user-avatar {
        width: 50px;
        height: 50px;
        border-radius: 50%;
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        display: flex;
        align-items: center;
        justify-content: center;
        color: white;
        font-weight: 600;
        font-size: 20px;
      }

      .btn-modern {
        border-radius: 8px;
        font-weight: 500;
        padding: 0.75rem 1.5rem;
        border: none;
        transition: all 0.3s ease;
      }

      .btn-primary {
        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      }

      .btn-primary:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
      }

      .btn-success {
        background: linear-gradient(135deg, #10b981 0%, #059669 100%);
      }

      .btn-success:hover {
        transform: translateY(-1px);
        box-shadow: 0 4px 12px rgba(16, 185, 129, 0.4);
      }

      .loading-skeleton {
        background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
        background-size: 200% 100%;
        animation: loading 1.5s infinite;
        border-radius: 4px;
        height: 20px;
      }

      @keyframes loading {
        0% { background-position: 200% 0; }
        100% { background-position: -200% 0; }
      }

      .empty-state {
        text-align: center;
        padding: 3rem;
        color: #64748b;
      }
    </style>

  <script>
    $(document).ready(function(){
      let User = localStorage.getItem("User")
      if (User) {
        $("#active").html(User);
        $("#userEmail").val(User);
        $("#exampleInputEmail1").val(User);
        let initial = User.charAt(0).toUpperCase();
        $("#userInitial").text(initial);
      }

      // Change password functionality
      $("#changepassword").click(function(){
        let obj = {
          url: "/change-pass",
          data: {
            email: $("#exampleInputEmail1").val(),
            oldpass: $("#oldPassword").val(),
            newpass: $("#newPassword").val()
          }
        };

        $.ajax(obj).done(function(resp){
          $("#changeErr").html(resp).addClass("text-success");
          if(resp.includes("Successfully")) {
            setTimeout(function() {
              $('#settingsModal').modal('hide');
              $("#oldPassword").val("");
              $("#newPassword").val("");
            }, 2000);
          }
        }).fail(function(){
          $("#changeErr").html("Error occurred").addClass("text-danger");
        });
      });

      // Load provider statistics
      function loadProviderStats() {
        const email = localStorage.getItem("User");
        if (email) {
          // Show loading state
          $(".stat-value").html('<div class="loading-skeleton"></div>');
          
          $.get("/provider-stats", { email: email }).done(function (stats) {
            $("#availableJobs").text(stats.availableJobs || 0);
            $("#totalEarnings").text("₹" + (stats.totalEarnings || 0));
            $("#completedJobs").text(stats.completedJobs || 0);
            $("#thisMonth").text(stats.thisMonth || 0);
          }).fail(function() {
            // Set default values on error
            $("#availableJobs").text("0");
            $("#totalEarnings").text("₹0");
            $("#completedJobs").text("0");
            $("#thisMonth").text("0");
          });
        }
      }

      // Load provider profile info
      function loadProviderInfo() {
        const email = localStorage.getItem("User");
        if (email) {
          $.get("/fetch-provider-details", { email: email }).done(function (provider) {
            if (provider && provider.length > 0) {
              const p = provider[0];
              $("#providerName").text(p.Fname || "Provider");
              $("#providerCategory").text(p.category || "Service Provider");
              if (p.profpic) {
                if (p.profpic.startsWith('http')) {
                  $("#providerImage").attr('src', p.profpic);
                } else {
                  $("#providerImage").attr('src', 'uploads/' + p.profpic);
                }
                $("#providerImage").show();
                $("#userInitial").hide();
              }
            }
          });
        }
      }

      // Load stats and info on page load
      loadProviderStats();
      loadProviderInfo();

      // Refresh stats every 30 seconds
      setInterval(loadProviderStats, 30000);
    });
  </script>
  </head>

  <body>
    <!-- Navigation -->
    <nav class="navbar navbar-expand-lg navbar-dark">
      <div class="container">
        <a class="navbar-brand fw-bold" href="/">
          <i class="fas fa-hands-helping me-2"></i>KarmYog
        </a>
        <div class="navbar-nav ms-auto">
          <div class="nav-item dropdown">
            <a class="nav-link dropdown-toggle d-flex align-items-center" href="#" role="button" data-bs-toggle="dropdown">
              <img id="providerImage" src="" alt="Profile" class="user-avatar me-2" style="display: none;">
              <div id="userInitial" class="user-avatar me-2"></div>
              <span id="active">Provider</span>
            </a>
            <ul class="dropdown-menu">
              <li><a class="dropdown-item" href="/providerprof"><i class="fas fa-user me-2"></i>My Profile</a></li>
              <li><a class="dropdown-item" href="#" data-bs-toggle="modal" data-bs-target="#settingsModal"><i class="fas fa-cog me-2"></i>Settings</a></li>
              <li><hr class="dropdown-divider"></li>
              <li><a class="dropdown-item" href="/logout"><i class="fas fa-sign-out-alt me-2"></i>Logout</a></li>
            </ul>
          </div>
        </div>
      </div>
    </nav>

    <div class="container mt-4">
      <!-- Page Header -->
      <div class="page-header">
        <div class="row align-items-center">
          <div class="col-md-8">
            <h1 class="h2 fw-bold text-dark mb-2">Provider Dashboard</h1>
            <p class="text-muted mb-0">Welcome back, <span id="providerName">Provider</span>! Manage your services and find new opportunities</p>
          </div>
          <div class="col-md-4 text-end">
            <span class="badge bg-success fs-6 px-3 py-2">
              <i class="fas fa-circle me-1" style="font-size: 8px;"></i>
              <span id="providerCategory">Active</span>
            </span>
          </div>
        </div>
      </div>

      <!-- Quick Stats -->
      <div class="row g-4 mb-4">
        <div class="col-md-3">
          <div class="card stats-card h-100">
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="stat-icon" style="background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);">
                  <i class="fas fa-briefcase"></i>
                </div>
                <div class="ms-3">
                  <h3 class="fw-bold mb-0 stat-value" id="availableJobs">0</h3>
                  <p class="text-muted small mb-0">Available Jobs</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-3">
          <div class="card stats-card h-100">
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="stat-icon" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%);">
                  <i class="fas fa-rupee-sign"></i>
                </div>
                <div class="ms-3">
                  <h3 class="fw-bold mb-0 stat-value" id="totalEarnings">₹0</h3>
                  <p class="text-muted small mb-0">Total Earnings</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-3">
          <div class="card stats-card h-100">
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="stat-icon" style="background: linear-gradient(135deg, #f59e0b 0%, #d97706 100%);">
                  <i class="fas fa-check-circle"></i>
                </div>
                <div class="ms-3">
                  <h3 class="fw-bold mb-0 stat-value" id="completedJobs">0</h3>
                  <p class="text-muted small mb-0">Completed Jobs</p>
                </div>
              </div>
            </div>
          </div>
        </div>

        <div class="col-md-3">
          <div class="card stats-card h-100">
            <div class="card-body">
              <div class="d-flex align-items-center">
                <div class="stat-icon" style="background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);">
                  <i class="fas fa-calendar-alt"></i>
                </div>
                <div class="ms-3">
                  <h3 class="fw-bold mb-0 stat-value" id="thisMonth">0</h3>
                  <p class="text-muted small mb-0">This Month</p>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Main Actions -->
      <div class="row g-4">
        <!-- Profile Management -->
        <div class="col-md-6">
          <div class="card action-card">
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <div class="stat-icon me-3" style="background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%); width: 50px; height: 50px; font-size: 20px;">
                  <i class="fas fa-user-tie"></i>
                </div>
                <div>
                  <h5 class="card-title fw-bold mb-1">My Profile</h5>
                  <p class="text-muted small mb-0">Manage your professional profile</p>
                </div>
              </div>
              <p class="text-muted mb-3">Update your professional information, skills, portfolio, and service categories to attract more customers.</p>
              <div class="d-flex gap-2 mb-3">
                <span class="badge bg-primary">Professional Info</span>
                <span class="badge bg-primary">Portfolio</span>
                <span class="badge bg-primary">Skills</span>
              </div>
              <a href="/providerprof" class="btn btn-primary btn-modern w-100">
                <i class="fas fa-edit me-2"></i>Edit Profile
              </a>
            </div>
          </div>
        </div>

        <!-- Find Jobs -->
        <div class="col-md-6">
          <div class="card action-card">
            <div class="card-body">
              <div class="d-flex align-items-center mb-3">
                <div class="stat-icon me-3" style="background: linear-gradient(135deg, #10b981 0%, #059669 100%); width: 50px; height: 50px; font-size: 20px;">
                  <i class="fas fa-search"></i>
                </div>
                <div>
                  <h5 class="card-title fw-bold mb-1">Find Jobs</h5>
                  <p class="text-muted small mb-0">Discover new opportunities</p>
                </div>
              </div>
              <p class="text-muted mb-3">Browse available jobs in your area and expertise. Filter by location, category, and requirements.</p>
              <div class="d-flex gap-2 mb-3">
                <span class="badge bg-success">Location Based</span>
                <span class="badge bg-success">Category Filter</span>
                <span class="badge bg-success">Real Time</span>
              </div>
              <a href="/fj" class="btn btn-success btn-modern w-100">
                <i class="fas fa-briefcase me-2"></i>Browse Jobs
              </a>
            </div>
          </div>
        </div>
      </div>

      <!-- Quick Actions -->
      <div class="mt-4">
        <div class="card">
          <div class="card-header">
            <h5 class="card-title mb-0">Quick Actions</h5>
          </div>
          <div class="card-body">
            <div class="row g-3">
              <div class="col-md-3">
                <button class="btn btn-outline-primary btn-modern w-100" data-bs-toggle="modal" data-bs-target="#settingsModal">
                  <i class="fas fa-cog mb-2 d-block" style="font-size: 1.5rem;"></i>
                  Settings
                </button>
              </div>
              <div class="col-md-3">
                <a href="/all-providersdash-improved.html" class="btn btn-outline-secondary btn-modern w-100">
                  <i class="fas fa-users mb-2 d-block" style="font-size: 1.5rem;"></i>
                  View All Providers
                </a>
              </div>
              <div class="col-md-3">
                <a href="/" class="btn btn-outline-info btn-modern w-100">
                  <i class="fas fa-home mb-2 d-block" style="font-size: 1.5rem;"></i>
                  Back to Home
                </a>
              </div>
              <div class="col-md-3">
                <a href="/logout" class="btn btn-outline-danger btn-modern w-100">
                  <i class="fas fa-sign-out-alt mb-2 d-block" style="font-size: 1.5rem;"></i>
                  Logout
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- Settings Modal -->
    <div class="modal fade" id="settingsModal" tabindex="-1" aria-labelledby="settingsModalLabel" aria-hidden="true">
      <div class="modal-dialog">
        <div class="modal-content">
          <div class="modal-header">
            <h5 class="modal-title" id="settingsModalLabel">Account Settings</h5>
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
          </div>
          <div class="modal-body">
            <form>
              <div class="mb-3">
                <label for="exampleInputEmail1" class="form-label">Email Address</label>
                <input type="email" class="form-control" id="exampleInputEmail1" readonly style="background-color: #f8f9fa;">
              </div>

              <div class="mb-3">
                <label for="oldPassword" class="form-label">Current Password</label>
                <input type="password" class="form-control" id="oldPassword" name="oldPassword" required>
              </div>

              <div class="mb-3">
                <label for="newPassword" class="form-label">New Password</label>
                <input type="password" class="form-control" id="newPassword" name="newPassword" required>
              </div>
            </form>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
            <button type="button" class="btn btn-primary" id="changepassword">
              <i class="fas fa-key me-2"></i>Change Password
            </button>
            <span id="changeErr" class="text-sm ms-3"></span>
          </div>
        </div>
      </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
  </body>
</html>
